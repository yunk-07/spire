# 卡牌扫描带动画实现说明

## 实现概述
已成功将摸牌动画改为扫描带让卡片逐渐出现，弃牌动画改为扫描带让卡牌逐渐消失。

## 主要修改内容

### 1. 动画控制器管理
- 在 `_BattlePageState` 类中添加了 `_cardAnimationControllers` 属性，用于管理每个卡牌的动画控制器
- 实现了 `dispose` 方法，确保在页面销毁时释放所有动画控制器

### 2. 摸牌动画实现
- 修改了 `_randomDrawCards` 方法，在卡牌添加到 `_dealingCards` 时创建并启动 800ms 时长的动画控制器
- 调整了延迟时间从 520ms 增加到 820ms，以配合扫描带动画的实现
- 在延迟结束后释放控制器，避免内存泄漏

### 3. 弃牌动画实现
- 修改了 `endTurn` 方法，在卡牌添加到 `_discardingCards` 时创建并启动 800ms 时长的动画控制器
- 调整了延迟时间从 520ms 增加到 820ms，回合延迟从 560ms 增加到 860ms
- 在延迟结束后释放控制器，避免内存泄漏

### 4. 扫描带动画UI实现
- 修改了 `_cardView` 方法，将原有的 Draggable 组件包装在 Stack 中
- 添加了两个 AnimatedBuilder 实现扫描带动画：
  - 摸牌时通过 `_cardAnimationControllers` 控制 heightFactor 从 0 到 1 实现渐显效果
  - 弃牌时通过 1 - _cardAnimationControllers.value 实现渐隐效果
- 移除了 hidden 变量及相关判断逻辑

## 技术细节

### 动画原理
扫描带动画通过控制一个覆盖在卡牌上的渐变遮罩的高度来实现卡牌的逐渐显示/隐藏效果。当 heightFactor 从 0 变化到 1 时，遮罩逐渐向上移动，卡牌逐渐显示出来；当 heightFactor 从 1 变化到 0 时，遮罩逐渐向下移动，卡牌逐渐隐藏起来。

### 性能优化
- 每个卡牌使用独立的动画控制器，确保动画的独立性和流畅性
- 在动画结束后及时释放控制器，避免内存泄漏
- 使用 TickerProviderStateMixin 提供高效的动画帧回调

## 运行效果
应用已成功启动，可通过 http://localhost:8080 访问并测试动画效果。在游戏过程中，摸牌和弃牌操作都会显示扫描带动画，提升了游戏的视觉体验。